<?php /*  Web site Title  */ ?>
<?php $__env->startSection('title'); ?>
Admin Dashboard:
@parent
<?php $__env->stopSection(); ?>

<?php /*  Content  */ ?>
<?php $__env->startSection('content'); ?>
<!-- content-header -->
<div class="content-header">
    <ul class="content-header-action pull-right">
        <li>

            <a href="#">
                <span data-chart="peity-bar" data-height="32" data-colours='["#00A600", "#00A600"]'>5,3,9,6,5,9,7,3,5,2</span>
                <div class="action-text color-green"><?php echo Cache::get('numpaidinvoices'); ?> <span class="helper-font-small color-silver-dark">Invoices paid</span></div>
            </a>
        </li>
        <li class="divider"></li>
        <li>
            <a href="#">
                <span data-chart="peity-bar" data-height="32" data-colours='["#00A0B1", "#00A0B1"]'>9,7,9,6,3,5,3,5,5,2</span>
                <div class="action-text color-teal"><?php echo Cache::get('numupcominginvoices'); ?> <span class="helper-font-small color-silver-dark">Upcoming invoices</span></div>
            </a>
        </li>
        <li class="divider"></li>
        <li>
            <a href="#">
                <span data-chart="peity-bar" data-height="32" data-colours='["#BF1E4B", "#BF1E4B"]'>6,5,9,7,3,5,2,5,3,9</span>
                <div class="action-text color-red"><?php echo Cache::get('numoverdueinvoices'); ?> <span class="helper-font-small color-silver-dark">Overdue</span></div>
            </a>
        </li>
    </ul>
    <h2><i class="icofont-home"></i> Dashboard <small>welcome</small></h2>
</div><!-- /content-header -->

<!-- content-breadcrumb -->
<div class="content-breadcrumb">
    <!--breadcrumb-nav-->
    <ul class="breadcrumb-nav pull-right">
        <li class="divider"></li>
        <?php if(!Sentry::getUser()->merchant_id && !Sentry::getUser()->merchantagreement_id): ?>
        <li class="btn-group">

            <a href="#" class="btn btn-small btn-link dropdown-toggle" data-toggle="dropdown">
                <i class="icofont-tasks"></i> Tasks
                <i class="icofont-caret-down"></i>
            </a>
            <ul class="dropdown-menu">
                <?php if($num_tobepaid>0): ?>
                <li><a href="<?php echo route('status/mainvoice', 2); ?>"><span class="color-red"><?php echo $num_tobepaid; ?> invoices to be paid</span></a></li>
                <?php endif; ?>
                <?php if(@$num_overdue>0): ?>
                <li class="divider"></li>
                <li><a href="<?php echo route('status/mainvoice', 6); ?>"> <?php echo $num_overdue; ?> overdue invoices </a></li>
                <?php endif; ?>
            </ul>
        </li>
        <?php endif; ?>
        <li class="divider"></li>
        <li class="btn-group">
            <a href="<?php echo URL::to('admin/mapayment'); ?>" class="btn btn-small btn-link">
                <i class="icofont-money"></i> Payments <span class="color-red">(+<?php echo Cache::get('numpayments'); ?>)</span>
            </a>
        </li>
        <li class="divider"></li>
        <li class="btn-group">
            <a href="<?php echo URL::to('admin/merchantagreement'); ?>" class="btn btn-small btn-link">
                <i class="icofont-user"></i> Merchant Agreements <span class="color-red">(+<?php echo Cache::get('nummerchantagreements'); ?>)</span>
            </a>
        </li>
    </ul><!--/breadcrumb-nav-->

    <!--breadcrumb-->
    <ul class="breadcrumb">
        <li><a href="<?php echo route('admin'); ?>"><i class="icofont-home"></i> Dashboard</a> <span class="divider">&rsaquo;</span></li>
        <li class="active">System overview</li>
    </ul><!--/breadcrumb-->
</div><!-- /content-breadcrumb -->

<!-- content-body -->
<div class="content-body">


<!-- dashboar -->
<!-- shortcut button -->
<div class="shortcut-group">

    <ul class="a-btn-group">

        <?php if(Sentry::getUser()->hasAccess('view_ma_invoices')): ?>
        <li>
            <a href="<?php echo URL::to('admin/mainvoice'); ?>" class="a-btn grd-white" rel="tooltip" title="Invoices">
                <span></span>
                <span><i class="icofont-barcode color-silver-dark"></i></span>
                <span class="color-silver-dark"><i class="icofont-file color-teal"></i></span>

            </a>
        </li>
        <?php endif; ?>

        <?php if(Sentry::getUser()->hasAccess('view_ma_payments')): ?>
        <li>
            <a href="<?php echo URL::to('admin/mapayment'); ?>" class="a-btn grd-white" rel="tooltip" title="Payments">
                <span></span>
                <span><i class="icofont-money color-silver-dark"></i></span>
                <span class="color-silver-dark"><i class="icofont-money color-red"></i></span>
            </a>
        </li>
        <?php endif; ?>

        <?php if(Sentry::getUser()->hasAccess('merchantagreement')): ?>
        <li>
            <a href="<?php echo URL::to('admin/merchantagreement'); ?>" class="a-btn grd-white" rel="tooltip" title="Merchant agreements">
                <span></span>
                <span><i class="icofont-briefcase color-silver-dark"></i></span>
                <span class="color-silver-dark"><i class="icofont-group color-silver-dark"></i></span>
            </a>
        </li>
        <?php endif; ?>

        <?php if(Sentry::getUser()->hasAccess('manage_reports')): ?>
        <li>
            <a href="#" class="a-btn grd-white" rel="tooltip" title="Reporting">
                <span></span>
                <span><i class="icofont-bar-chart color-silver-dark"></i></span>
                <span class="color-silver-dark"><i class="typicn-lineChart"></i></span>
            </a>
        </li>
        <?php endif; ?>

        <li class="clearfix"></li>
    </ul>
</div><!-- /shortcut button -->

<div class="divider-content"><span></span></div>

<!-- tab stat -->
<div class="box-tab corner-all">
    <div class="box-header corner-top">
        <div class="header-control pull-right">
            <a data-box="collapse"><i class="icofont-caret-up"></i></a>
        </div>
        <h4>Last 10 days overview</h4>
        <ul class="nav nav-tabs" id="tab-stat">
            <li class="active"><a data-toggle="tab" href="#system-stat">Numbers</a></li>
            <?php foreach($allcurrencies as $currency): ?>
            <li><a data-toggle="tab" href="#<?php echo $currency->currency; ?>"><?php echo $currency->currency; ?> Traffic</a></li>
            <?php endforeach; ?>
        </ul>
    </div>
    <div class="box-body">
        <div class="tab-content">
            <div class="tab-pane fade in active" id="system-stat">
                <div class="row-fluid">
                    <div class="span4">
                        <div class="dashboard-stat" rel="tooltip" title="Transactions per merchant agreement">

                            <?php echo Lava::PieChart('Transactions')->outputInto('transactions_div');; ?>
                            <?php echo Lava::div(600, 300);; ?>

                            <div class="stat-label grd-green color-white">Transactions per Merchant agreement</div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="dashboard-stat">

                            <?php echo Lava::AreaChart('Chargebacks')->outputInto('chb_div');; ?>
                            <?php echo Lava::div(600, 300);; ?>

                            <div class="stat-label grd-teal color-white">CHB per Merchant agreement</div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="dashboard-stat">
                            <?php echo Lava::ColumnChart('Refunds')->outputInto('refunds_div');; ?>
                            <?php echo Lava::div(600, 300);; ?>

                            <div class="stat-label grd-red color-white">Refunds per Merchant Agreement</div>
                        </div>
                    </div>
                </div>
            </div>

            <?php foreach($allcurrencies as $currency): ?>
            <div class="tab-pane fade" id="<?php echo $currency->currency; ?>">
                <div class="row-fluid">
                    <div class="span4">
                        <div class="dashboard-stat" rel="tooltip" title="Transactions amount (<?php echo $currency->currency; ?>)">
                            <?php echo Lava::ColumnChart('transaction_'.$currency->currency)->outputInto('transactionsamount_div_'.$currency->currency);; ?>
                            <?php echo Lava::div(600, 300);; ?>
                            <div class="stat-label grd-green color-white">Transactions amount (<?php echo $currency->currency; ?>)</div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="dashboard-stat" rel="tooltip" title="CHB amounts (<?php echo $currency->currency; ?>)">
                            <?php echo Lava::AreaChart('chb_'.$currency->currency)->outputInto('chbamount_div_'.$currency->currency);; ?>
                            <?php echo Lava::div(600, 300);; ?>
                            <div class="stat-label grd-teal color-white">CHB amounts (<?php echo $currency->currency; ?>)</div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="dashboard-stat" rel="tooltip" title="Refunds amount (<?php echo $currency->currency; ?>)">
                            <?php echo Lava::ColumnChart('refunds_'.$currency->currency)->outputInto('refundssamount_div_'.$currency->currency);; ?>
                            <?php echo Lava::div(600, 300);; ?>
                            <div class="stat-label grd-red color-white">Refunds amount (<?php echo $currency->currency; ?>)</div>
                        </div>
                    </div>
                </div>
            </div>
            <?php endforeach; ?>
        </div>
    </div>
</div><!-- /tab stat -->

<div class="divider-content"><span></span></div>

<div class="row-fluid">
    <!-- tab resume update -->
    <?php if(Sentry::getUser()->hasAccess('view_ma_invoices')): ?>
    <div class="span6">
        <div class="box-tab corner-all">
            <div class="box-header corner-top">
                <!--tab action-->
                <div class="header-control pull-right">
                    <a data-box="collapse"><i class="icofont-caret-up"></i></a>
                    <a data-box="close" data-hide="rotateOutDownLeft">&times;</a>
                </div>
                <ul class="nav nav-pills">
                    <!--tab menus-->
                    <li class="active"><a data-toggle="tab" href="#new_invoices">New Invoices</a></li>
                    <li><a data-toggle="tab" href="#partially_paid">Partially Paid</a></li>
                    <li><a data-toggle="tab" href="#tobepaid">To be paid <?php if(Cache::get('numtobepaid')): ?> <span class="badge badge-important"><?php echo Cache::get('numtobepaid'); ?></span> <?php endif; ?></a>  </li>

                    <li><a data-toggle="tab" href="#overdue">Overdue <?php if(Cache::get('numoverdueinvoices')>0): ?> <span class="badge badge-important"><?php echo Cache::get('numoverdueinvoices'); ?></span> <?php endif; ?></a></li>
                    <!--tab menus-->
                </ul>
            </div>
            <div class="box-body">
                <!-- widgets-tab-body -->
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="new_invoices">
                        <?php if(@count($new_invoices)): ?>
                        <?php foreach($new_invoices as $new_inv): ?>
                        <div class="media">
                            <a class="pull-left" href="#">

                                <a href="<?php echo route('show/mainvoice', $new_inv->id); ?>" class="a-btn square grd-white" title="Show Invoice # <?php echo $new_inv->id; ?>">
                                    <span></span>

                                    <span class="color-silver-dark" style="font-size: 16px; font-weight: bolder; color: lightcoral"> #<?php echo $new_inv->invoiceid; ?></span>
                                    <span class="color-silver-dark" style="font-size: 16px; color: lightcoral"> #<?php echo $new_inv->invoiceid; ?></span>

                                </a>
                            </a>
                            <div class="media-body">
                                <h4 class="media-heading"><a href="#"><?php echo $new_inv->merchantagreement()->name; ?> </a><small class="helper-font-small"> From <?php echo date('M d, Y', strtotime($new_inv->date_from)); ?> To <?php echo date('M d, Y', strtotime($new_inv->date_to)); ?></small></h4>
                                <table class="table" style="width: 500px">
                                    <tr>
                                        <th>Merchant</th>
                                        <td><?php echo $new_inv->merchant()->merchant; ?></td>
                                    </tr>
                                    <tr>
                                        <th>Amount</th>
                                        <th><span class="label label-warning"><?php echo ($new_inv->amount!=0? $new_inv->amount : 0); ?> <?php echo $new_inv->processcurrency; ?></span></th>
                                    </tr>
                                </table>
                                <div class="btn-group pull-right">
                                    <a href="<?php echo route('show/mainvoice', $new_inv->id); ?>" class="btn btn-mini">Show</a>
                                    <?php if(($new_inv->invoicestatus($new_inv->id)->status == 'draft' || $new_inv->invoicestatus($new_inv->id)->status == 'approved' || $new_inv->invoicestatus($new_inv->id)->status == 'min_payout_not_met' || $new_inv->invoicestatus($new_inv->id)->status == 'tobepaid') && Sentry::getUser()->hasAccess('manage_ma_invoices')): ?>
                                    <a href="<?php echo route('update/mainvoice', $new_inv->id); ?>" class="btn btn-mini btn-primary">Edit</a>
                                    <?php endif; ?>

                                </div>
                            </div>
                        </div>
                        <?php endforeach; ?>


                        <a href="<?php echo URL::to('admin/mainvoice'); ?>" class="btn btn-small btn-link pull-right">View all &rarr;</a>
                        <?php else: ?>
                        No invoices have been generated today.
                        <?php endif; ?>
                    </div>

                    <div class="tab-pane fade" id="partially_paid">
                        <?php if(@count($ppaid_invoices)): ?>
                        <?php foreach($ppaid_invoices as $ppaid_inv): ?>
                        <div class="media">
                            <a class="pull-left" href="#">

                                <a href="<?php echo route('show/mainvoice', $ppaid_inv->mainvoice_id); ?>" class="a-btn square grd-white" title="Show Invoice # <?php echo $ppaid_inv->id; ?>">
                                    <span></span>

                                    <span class="color-silver-dark" style="font-size: 16px; font-weight: bolder; color: teal"> #<?php echo $ppaid_inv->invoiceid; ?></span>
                                    <span class="color-silver-dark" style="font-size: 16px; color: teal"> #<?php echo $ppaid_inv->invoiceid; ?></span>

                                </a>
                            </a>
                            <div class="media-body">
                                <h4 class="media-heading"><a href="#"><?php echo $ppaid_inv->merchantagreement()->name; ?> </a><small class="helper-font-small"> From <?php echo date('M d, Y', strtotime($ppaid_inv->date_from)); ?> To <?php echo date('M d, Y', strtotime($ppaid_inv->date_to)); ?></small></h4>
                                <table class="table" style="width: 500px">
                                    <tr>
                                        <th>Merchant: <?php echo $ppaid_inv->paid(); ?></th>
                                        <td><?php echo $ppaid_inv->merchant()->merchant; ?></td>
                                    </tr>
                                    <tr>
                                        <th>Amount Payable</th>
                                        <th><span class="label label-warning"><?php echo $total[$ppaid_inv->mainvoice_id]; ?> <?php echo $ppaid_inv->processcurrency; ?></span></th>
                                    </tr>
                                    <tr>
                                        <th>Paid</th>
                                        <th><span class="label label-success"><?php echo $paid[$ppaid_inv->mainvoice_id]; ?> <?php echo $ppaid_inv->processcurrency; ?></span></th>
                                    </tr>
                                    <tr>
                                        <th>Upaid</th>
                                        <th><span class="label label-important"><?php echo $unpaid[$ppaid_inv->mainvoice_id]; ?> <?php echo $ppaid_inv->processcurrency; ?></span></th>
                                    </tr>
                                </table>
                                <div class="btn-group pull-right">
                                    <a href="<?php echo route('show/mainvoice',  $ppaid_inv->mainvoice_id); ?>" class="btn btn-mini">Show</a>
                                    <a class="btn btn-mini btn-primary" href="<?php echo route('pay/mapayment', $ppaid_inv->mainvoice_id); ?>" class="btn btn-mini">Pay</a>

                                </div>
                            </div>
                        </div>
                        <?php endforeach; ?>

                        <a href="<?php echo route('status/mainvoice', 4); ?>" class="btn btn-small btn-link pull-right">View all &rarr;</a>
                        <?php else: ?>
                        No partially paid invoices found
                        <?php endif; ?>
                    </div>

                    <div class="tab-pane fade" id="tobepaid">
                        <?php if(@count($tobepaid)): ?>
                        <?php foreach($tobepaid as $tbpaid): ?>
                        <div class="media">
                            <a class="pull-left" href="#">

                                <a href="<?php echo route('show/mainvoice', $tbpaid->id); ?>" class="a-btn square grd-white" title="Show Invoice # <?php echo $tbpaid->id; ?>">
                                    <span></span>

                                    <span class="color-silver-dark" style="font-size: 16px; font-weight: bolder; color: darkred"> #<?php echo $tbpaid->invoiceid; ?></span>
                                    <span class="color-silver-dark" style="font-size: 16px; color: darkred"> #<?php echo $tbpaid->invoiceid; ?></span>

                                </a>
                            </a>
                            <div class="media-body">
                                <h4 class="media-heading"><a href="#"><?php echo $tbpaid->merchantagreement()->name; ?> </a><small class="helper-font-small"> From <?php echo date('M d, Y', strtotime($tbpaid->date_from)); ?> To <?php echo date('M d, Y', strtotime($tbpaid->date_to)); ?></small></h4>
                                <table class="table" style="width: 500px">
                                    <tr>
                                        <th>Merchant</th>
                                        <td><?php echo $tbpaid->merchant()->merchant; ?></td>
                                    </tr>
                                    <tr>
                                        <th>Amount</th>
                                        <th><span class="label label-warning"><?php echo ($tbpaid->amount!=0? $tbpaid->amount : 0); ?> <?php echo $tbpaid->processcurrency; ?></span></th>
                                    </tr>
                                    <tr>
                                        <th>Payout due</th>
                                        <th><div class="alert alert-error">
                                            <span class="label label-important"><?php echo date("D d, Y", strtotime($tbpaid->payout_date)); ?></span>
                                        </div>
                                        </th>
                                    </tr>
                                </table>
                                <div class="btn-group pull-right ">
                                    <a href="<?php echo route('show/mainvoice', $tbpaid->id); ?>" class="btn btn-mini">Show</a>
                                    <?php if($tbpaid->invoicestatus($tbpaid->id)->status == 'draft' || $tbpaid->invoicestatus($tbpaid->id)->status == 'sent'): ?>
                                    <a href="<?php echo route('update/mainvoice', $tbpaid->id); ?>" class="btn btn-mini btn-primary">Edit</a>
                                    <?php endif; ?>

                                </div>
                            </div>
                        </div>
                        <?php endforeach; ?>

                        <a href="<?php echo route('status/mainvoice', 2); ?>" class="btn btn-small btn-link pull-right">View all &rarr;</a>
                        <?php else: ?>
                        No invoices are to be paid today.
                        <?php endif; ?>
                    </div>

                    <div class="tab-pane fade" id="overdue">
                        <?php foreach($overdue_invoices as $od): ?>
                        <div class="media">
                            <a class="pull-left" href="#">

                                <a href="<?php echo route('show/mainvoice', $od->id); ?>" class="a-btn square grd-white" title="Show Invoice # <?php echo $od->id; ?>">
                                    <span></span>

                                    <span class="color-silver-dark" style="font-size: 16px; font-weight: bolder; color: darkred"> #<?php echo $od->invoiceid; ?></span>
                                    <span class="color-silver-dark" style="font-size: 16px; color: darkred"> #<?php echo $od->invoiceid; ?></span>

                                </a>
                            </a>
                            <div class="media-body">
                                <h4 class="media-heading"><a href="#"><?php echo $od->merchantagreement()->name; ?> </a><small class="helper-font-small"> From <?php echo date('M d, Y', strtotime($od->date_from)); ?> To <?php echo date('M d, Y', strtotime($od->date_to)); ?></small></h4>
                                <table class="table" style="width: 500px">
                                    <tr>
                                        <th>Merchant</th>
                                        <td><?php echo $od->merchant()->merchant; ?></td>
                                    </tr>

                                    <tr>
                                        <th>Amount</th>
                                        <th>
                                            <span class="label label-warning"><?php echo ($od->amount!=0? $od->amount : 0); ?> <?php echo $od->processcurrency; ?></span></th>
                                    </tr>
                                    <tr>
                                        <th>Payout date</th>
                                        <th><div class="alert alert-error"><?php echo date('M d, Y', strtotime($od->payout_date)); ?></div></th>
                                    </tr>
                                </table>
                                <div class="btn-group pull-right">
                                    <a href="<?php echo route('show/mainvoice', $od->id); ?>" class="btn btn-mini">Show</a>
                                    <?php if($od->invoicestatus($od->id)->status == 'draft' || $od->invoicestatus($od->id)->status == 'sent'): ?>
                                    <a href="<?php echo route('update/mainvoice', $od->id); ?>" class="btn btn-mini btn-primary">Edit</a>
                                    <?php endif; ?>

                                </div>
                            </div>
                        </div>
                        <?php endforeach; ?>

                        <a href="<?php echo route('status/mainvoice', 6); ?>" class="btn btn-small btn-link pull-right">View all &rarr;</a>
                    </div>
                </div><!--/widgets-tab-body-->
            </div><!--/box-body-->
        </div><!--/box-tab-->
    </div><!-- tab resume update -->
    <?php endif; ?>

    <?php if(Sentry::getUser()->hasAccess('view_ma_payments')): ?>
    <div class="span6">
        <div class="box corner-all">
            <div class="box-header corner-top grd-white">
                <div class="header-control">
                    <a data-box="collapse"><i class="icofont-caret-up"></i></a>
                    <a data-box="close" data-hide="rotateOutDownRight">&times;</a>
                </div>
                <span><i class="icofont-money"></i> Recent payments</span>
            </div>
            <div class="box-body">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Merchant Agreement</th>
                        <th>Merchant</th>
                        <th>Amount</th>
                        <th>Invoice</th>
                        <th>Date</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php foreach($recentpayments as $recentpayment): ?>
                    <tr>
                        <td>
                            <?php if(Sentry::getUser()->hasAccess('merchant')): ?>
                            <a href="<?php echo route('show/merchant', $recentpayment->paymentinvoice()->merchant()->id); ?>" class="btn btn-mini" target="_blank"><?php echo $recentpayment->paymentinvoice()->merchant()->merchant; ?></a>
                            <?php else: ?>
                            <?php echo $recentpayment->paymentinvoice()->merchant()->merchant; ?>
                            <?php endif; ?>
                        </td>
                        <td>
                            <?php if(Sentry::getUser()->hasAccess('merchantagreement')): ?>
                            <a href="<?php echo route('show/ma', $recentpayment->paymentinvoice()->merchantagreement()->id); ?>" class="btn btn-mini" target="_blank"><?php echo $recentpayment->paymentinvoice()->merchantagreement()->name; ?></a>
                            <?php else: ?>
                            <?php echo $recentpayment->paymentinvoice()->merchantagreement()->name; ?>
                            <?php endif; ?>
                        </td>
                        <td><span class="label label-info"><?php echo ($recentpayment->amount_payout!=0? $recentpayment->amount_payout : 0); ?> <?php echo $recentpayment->paymentinvoice()->merchantagreement()->paramval('payoutcurrency')->map_value; ?></span></td>
                        <td>
                            <?php if(Sentry::getUser()->hasAccess('view_ma_invoices')): ?>
                            <a href="<?php echo route('show/mainvoice', $recentpayment->mainvoice_id); ?>" class="btn btn-mini"  target="_blank">#<?php echo $recentpayment->paymentinvoice()->invoiceid; ?></a>
                            <?php else: ?>
                            #<?php echo $recentpayment->mainvoice_id; ?>
                            <?php endif; ?>
                        </td>
                        <td><?php echo date('M d, Y', strtotime($recentpayment->created_at)); ?></td>
                    </tr>
                    <?php endforeach; ?>
                    <tr>
                    <td colspan="5"><a href="<?php echo route('mapayment'); ?>" class="btn btn-small btn-link pull-right">View all &rarr;</a></td>
                    </tr>
                    </tbody>

                </table>

            </div>

        </div>

    </div>
    <?php endif; ?>

</div><!-- tab stat -->

<div class="divider-content"><span></span></div>

<?php echo $__env->make('backend/layouts/right_sidebar', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

<!--schedule-->


<!--schedule-->
<?php $__env->stopSection(); ?>
<?php echo $__env->make('backend/layouts/main', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>